<!DOCTYPE HTML>
<html>
    <head>
        <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.3/build/pure-min.css"
            integrity="sha384-cg6SkqEOCV1NbJoCu11+bm0NvBRc8IYLRGXkmNrqUBfTjmMYwNKPWBTIKyw9mHNJ" crossorigin="anonymous">
        <link rel="stylesheet" href="{{ url_for('static',filename='mainstyle.css') }}">
        <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <center>
            <div class="shelf" number="1">
                <div class="strip"></div>
                <h1>Shelf 1</h1>
                <div class="picker" id="picker1" name="1"></div>                
            </div>
        </center>
        <center>
            <div class="shelf" number="2">
                <div class="strip"></div>
                <h1>Shelf 2</h1>
                <div class="picker" id="picker2" name="2"></div>             
            </div>
        </center>
        <center>
            <div class="shelf" number="3">
                <div class="strip"></div>
                <h1>Shelf 3</h1>
                <div class="picker" id="picker3" name="3"></div>                
            </div>
        </center>
        <center>
            <div class="shelf" number="4">
                <div class="strip"></div>
                <h1>Shelf 4</h1>
                <div class="picker" id="picker4" name="4"></div>  
            </div>
        </center>
        <center>
            <div class="shelf" number="5">
                <div class="strip"></div>
                <h1>Shelf 5</h1>
                <div class="picker" id="picker5" name="5"></div>  
               
            </div>
        </center>
        <center>
            <div class="shelf" number="6">
                <div class="strip"></div>
                <h1>Shelf 6</h1>
                <div class="picker" id="picker6" name="6"></div>  
            </div>
        </center>
        <center>
            <div class="shelf" number="7">
                <div class="strip"></div>
                <h1>Shelf 7</h1>
                <div class="picker" id="picker7" name="7"></div>  
            </div>
        </center>
        <center>
            <div class="shelf" number="8">
                <div class="strip"></div>
                <h1>Shelf 8</h1>
                <div class="picker" id="picker8" name="8"></div>  
            </div>
        </center>
        <center>
            <div class="shelf" number="9">
                <div class="strip"></div>
                <h1>Shelf 9</h1>
                <div class="picker" id="picker9" name="9"></div>  
            </div>
        </center>
        <center>
            <div class="shelf"name="10">
                <div class="strip"></div>
                <h1>Floor Left </h1>
                <div class="picker" id="picker10" name="10"></div>  
            </div>
        </center>
        <center>
            <div class="shelf" name="11">
                <div class="strip"></div>
                <h1>Floor Middle </h1>
                <div class="picker" id="picker11" name="11"></div>  
            </div>
        </center>
        <center>
            <div class="shelf">
                <div class="strip"></div>
                <h1>Floor Right </h1>
                <div class="picker" id="picker12" name="12"></div>
                <!-- <form id="FloorRightLights">
                    <input type="color" id="shelfColor" value="ff0000" name="FloorRight">
                    <input type="submit" value="Run Lights" />
                </form> -->
            </div>
        </center>
        <center>
            <div class="shelf">
                <div class="strip"></div>
                <h1>The Bar</h1>
                <form id="allLightsOn">
                    <input type="submit" value="Run Lights" />
                </form>

                <form id="allLightsOff">
                    <input type="submit" value="Stop Lights" />
                </form>

                <form id="movingLEDrun">
                    <input type="submit" value="Moving LEDs" />
                </form>

                <form id="shelfRandomColours">
                    <input type="submit" value="Shelf Random Colours" />
                </form>

                <form id="rainbow">
                    <input type="submit" value="Rainbow Cycle" />
                </form>
            </div>
        </center>

        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                console.log("hiding pickers")
                const pickers = $(".picker")
                pickers.each(function(index, picker){
                    $(picker).toggle();
                });
            });

            function setStripColor(shelf, hexColor) {
                $('.shelf[number=' + shelf + '] .strip').css('background', hexColor);
            }
            //Shelfs
            var colorPicker1 = new iro.ColorPicker('#picker1');
            var colorPicker2 = new iro.ColorPicker('#picker2');
            var colorPicker3 = new iro.ColorPicker('#picker3');
            var colorPicker4 = new iro.ColorPicker('#picker4');
            var colorPicker5 = new iro.ColorPicker('#picker5');
            var colorPicker6 = new iro.ColorPicker('#picker6');
            var colorPicker7 = new iro.ColorPicker('#picker7');
            var colorPicker8 = new iro.ColorPicker('#picker8');
            var colorPicker9 = new iro.ColorPicker('#picker9');
            // //Floor
            var colorPicker10 = new iro.ColorPicker('#picker10');
            var colorPicker11 = new iro.ColorPicker('#picker11');
            var colorPicker12 = new iro.ColorPicker('#picker12');
            //Bar
            

            let selectedColor = '#000000';

            colorPicker1.on('color:change', function (color) {
                selectedColor = color.hexString;
             });
            colorPicker2.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker3.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker4.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker5.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker6.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker7.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker8.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker9.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker10.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker11.on('color:change', function (color) {
                selectedColor = color.hexString;
            });
            colorPicker12.on('color:change', function (color) {
                selectedColor = color.hexString;
            });


            $('.picker').on('pointerup', function (e) {
                const shelf = e.currentTarget.attributes.getNamedItem('name').value;

                const data = {
                    colour: hexToRgb(selectedColor),
                    shelf: shelf
                };

                setStripColor(shelf, selectedColor);

                $.ajax({
                    type: 'POST',
                    url: '/api/shelfLights',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are on");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });

            function hexToRgb(hex) {
                var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            }

            $(".shelf").click(function(event) {
                console.log(event);

                const shelf = event.currentTarget;
                const picker = $(shelf).find('.picker .IroColorPicker')[0];
                const pickerBounds = picker.getBoundingClientRect();

                if (
                    event.pageX >= pickerBounds.x && 
                    event.pageY >= pickerBounds.y && 
                    event.pageX <= pickerBounds.x + pickerBounds.width &&
                    event.pageY <= pickerBounds.y + pickerBounds.height
                ) {
                    console.log('Nah mate');
                } else {                    
                    $(picker).toggle;
                }
            });

            // $('#shelfLights1').add('#shelfLights2').add('#shelfLights3').add('#shelfLights4').add('#shelfLights5').add('#shelfLights6').add('#shelfLights7').add('#shelfLights8').add('#shelfLights9').add('#FloorRightLights').add('#FloorLeftLights').add('#FloorMiddleLights').submit(function (e) {
            //     e.preventDefault();
            //     var form = $(this);
            //     var data = {};
            //     $.each(form, function (index, value) {
            //         colour = hexToRgb((this.shelfColor).value);
            //         shelf = (this.shelfColor.name)
            //         var data = { "colour": colour, "shelf": shelf };
            //     });
            //     var data = { "colour": colour, "shelf": shelf };
            //     console.log(data)
            //     $.ajax({
            //         type: 'POST',
            //         url: '/api/shelfLights',
            //         dataType: 'String',
            //         contentType: 'application/json; charset=utf-8',
            //         data: JSON.stringify(data),
            //         success: function (callback) {
            //             console.log(callback);
            //             // Watch out for Cross Site Scripting security issues when setting dynamic content!
            //             $(this).html("They are on");
            //         },
            //         error: function () {
            //             $(this).html("error!");
            //         }
            //     });
            // });

            $('#allLightsOn').submit(function (e) {
                e.preventDefault();

                var data = {};

                $.ajax({
                    type: 'POST',
                    url: '/api/allLightsOn',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are on");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });

            $('#allLightsOff').submit(function (e) {
                e.preventDefault();

                var data = {};

                $.ajax({
                    type: 'POST',
                    url: '/api/allLightsOff',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are off");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });

            $('#movingLEDrun').submit(function (e) {
                e.preventDefault();

                var data = {};

                $.ajax({
                    type: 'POST',
                    url: '/api/movingLEDrun',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are off");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });

            $('#shelfRandomColours').submit(function (e) {
                e.preventDefault();

                var data = {};

                $.ajax({
                    type: 'POST',
                    url: '/api/shelfRandomColours',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are off");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });

            $('#rainbow').submit(function (e) {
                e.preventDefault();

                var data = {};

                $.ajax({
                    type: 'POST',
                    url: '/api/rainbow',
                    dataType: 'String',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    success: function (callback) {
                        console.log(callback);
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $(this).html("They are off");
                    },
                    error: function () {
                        $(this).html("error!");
                    }
                });
            });
        </script>
    </body>
</html>